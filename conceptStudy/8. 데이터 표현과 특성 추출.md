# 8. 데이터 표현과 특성 추출

참고문헌 : 
1. 구글 머신러닝 단기 집중과정

[Google의 머신러닝 단기 집중과정](https://developers.google.com/machine-learning/crash-course/ml-intro?hl=ko)

## 특성 추출이란?

우리가 실무에서 사용하는 데이터셋은 형식이 잘 정리된 특성 벡터들이 아니다.

즉, 데이터베이스의 기록이나 프로토콜 버퍼와 같이 그냥 아무런 기준 없이 정리된 데이터셋들이다.

우리는 이렇게 다양한 성질을 가진 데이터 소스에서 데이터를 가져와 특성을 추출해야한다.

원시 데이터에서 특성을 추출하는 과정을 **특성 추출**이라고 한다.

머신러닝 개발자는 업무시간의 75퍼센트 정도를 특성을 추출하는데 사용할 정도로 특성은 중요한 부분이다.

![8-1](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-1.PNG)

## 특성 추출 방법

특성을 어떻게 추출할까?

숫자로 이루어져 있는 값들은 특성으로 사용하기에 아주 자연스럽다.(집의 방 갯수) 하지만 문자열로 이루어져 있는 특성은 사용하기에 어렵다.(street_name)

### 숫자형 특성의 추출

![8-2](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-2.PNG)

### 범주형 특성의 추출

범주형 특성은 다음 그림처럼 주로 **원-핫 인코딩**을 통해 특성을 바꾸는 경우가 많다.

![8-3](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-3.PNG)

이러한 방식을 통해 모든 특성 값(여기서는 거리 이름)에 대한 부울 변수를 효과적으로 만들 수 있다.

즉, 위의 그림처럼 집이 Shorebird Way에 있는 경우에만 특성 Shorebird Way 값이 1이 되는 것이다.

### 희소 표현

데이터셋에서 street_name의 값으로 포함하고 싶은 거리 이름이 백만 개가 있다고 가정해보자.

이 때, 1개 또는 2개의 요소만 true인 요소 백만 개의 바이너리 벡터를 명시적으로 만드는 것은 이러한 벡터(list, 배열)를 처리할 때의 용량 및 계산 시간을 고려했을 때 매우 비효율적일 것이다.

이러한 상황에서는 일반적으로 0이 아닌 값만 저장되는 희소 표현을 사용한다.

![8-4](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-4.PNG)

## 좋은 특성의 조건

### 거의 사용되지 않는 불연속 특성 값 배제

좋은 특성 값은 데이터 세트에서 5회 이상 나타나야 한다. 이러한 특성 값은 모델에서 라벨과의 관계를 학습하기에 쉽다. 아래의 예처럼 house_type 특성은 값이 victorian인 데이터를 많이 포함하고 있다.

    house_type: victorian

특성의 값이 한 번만 나타나거나 매우 드물게 나타난다면 해당 특성을 제거하는 것이 좋다. 아래의 예처럼 unique_house_id는 각 값이 한 번만 사용되어 모델에서 어떠한 학습도 불가능하므로 제거하는 것이 좋다.

    unique_house_id: 8SK982Z7237126

### 분명하고 명확한 의미 부여

각 특성은 분명하고 명확한 의미를 가져야만 한다.

예를 들어, 다음 특성은 주택의 연력을 연 단위로 나타내기 때문에 바로 알아볼 수 있는 좋은 특성이다.

    house_age: 27

하지만 다음의 특성은 엔지니어 외에 다른 사람은 알아보기 힘들기 때문에 알아보기 어렵다. 따라서, 좋지 않은 특성이다.

    house_age: 851472000

엔지니어링 측면의 실수와 관계없이 데이터의 노이즈로 인해 값이 불명확해지는 경우도 있다. 예를 들어 다음의 user_age는 적절한 값을 확인하지 않아서 비롯된 것이다.

    user_age: 277

### 특수 값을 실제 데이터와 혼용하지 말 것

좋은 부동 소수점 특성은 특이한 값을 가지지 않는다. 예를 들어 어떤 특성이 0~1 범위의 부동 소수점 값을 갖는다고 가정해보자. 그렇다면 다음과 같은 특성은 문제가 없다.

    quality_rating: 0.82
    quality_rating: 0.37

하지만 프로그램 사용자가 quality_rating을 입력하지 않은 경우를 표현하기 위해 엔지니어는 데이터 셋에 다음과 같은 특수 값으로 데이터가 없음을 표현하려고 했을 수도 있다.

    quality_rating: -1

**이러한 특성 값은 실제 데이터가 아니기에 모델을 학습시킬 때 영향을 끼치면 안 된다.**

따라서, 굳이 데이터가 없음을 표기하고 싶다면 아래와 같은 방법을 사용해야만 한다.

![8-5](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-5.PNG)

### 특성은 시간이 지나도 변하지 않아야 한다.

예를 들어 도시의 이름은 일반적으로 바뀌지 않으므로 다음 값은 유용하다.

    city_id: "br/sao_paulo"

그러나 다른 모델에서 추론한 값을 수집할 때는 또 다른 문제점이 있다.

"219"라는 값이 현재 상파울루를 나타내고 있더라도 다른 모델을 이후에 실행할 때는 이 표현이 변경될 수도 있다. 왜냐하면 이전 모델에서 상파울루를 "421"로 바뀌면 특성 값이 변하기 때문이다.

    inferred_city_cluster: "219"

## 데이터 정제

### 특성 값 조정

부동 소수점 특성 값을 100~900 등의 **자연 범위에서 0 ~ 1 또는 -1 ~ +1 등의 표준 범위로 변환**하는 가정이다.

즉, **부동 소수점 특성을 Z 점수라는 표준편차를 기반으로 바꾸는 것**을 의미한다.

이 방법은 다음과 같은 이점을 누릴 수 있다.

![8-6](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-6.PNG)

### 극단적 이상점 처리

다음은 캘리포니아 주택 데이터 세트에서 얻은 roomsPerPerson이라는 특성을 나타낸 plot이다.

![8-7](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-7.PNG)

roomsPerPerson 값은 지역의 전체 방 수를 해당 지역의 인구로 나누어 계산한다. 위의 그림처럼 캘리포니아의 대부분 지역은 1인당 1~2개의 방을 갖추고 있다. 그러나 x축을 살펴보면 1인당 방이 50개인 지역도 있다.

이러한 극단적 이상점은 모델의 학습에 도움이 되지 못할 뿐더러, 상식적으로도 이해가 되지 않는 현상이다.

이러한 방법을 해결하기 위한 첫번째 방법으로 다음과 같이 모든 값의 로그를 취하는 방법이 있다.

![8-8](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-8.PNG)

로그 조정을 거치면 상황이 다소 개선되지만 아직도 꼬리가 남아있다. 다른 접근법을 시도해보면 다음과 같이 roomsPerPerson의 최대값을 4.0 같은 임의의 지점에서 잘라내어 제한을 두는 것이다.

![8-9](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-9.PNG)

이 때, 주의할 점은 4.0보다 큰 값은 모두 무시한다는 의미가 아니라, 4.0보다 큰 값을 모두 4.0으로 인식하겠다는 의미이다.

따라서, 4.0 지점에 부자연스러운 경계가 생기지만 이전의 데이터보다 훨씬 유용해진 상태이다.

### 비닝 기법

데이터 세트에서 latitude(위도)는 부동 소수점 값이다.

![8-10](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-10.PNG)

그러나 이 모델에서 latitude를 부동 소수점 특성으로 표현할 수는 없다. 이는 위도와 주택 값 사이에 선형적 관계가 없기 때문이다. 예를 들어, 위도 35도에 위치한 주택이 위도 34도에 위치한 주택보다 35/34만큼 싸거나 비싸지는 않다.

그러나 각각의 위도 값은 주택 가격을 예측하는 좋은 지표일 가능성이 높기 때문에 위도를 특성으로 만드는 것이 필요할 것이다.

이럴 때, 다음과 같이 비닝 기법을 사용한다.

****

![8-11](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-11.PNG)

****

이제 부동 소수점 특성 하나가 아니라, 11개의 개별 부울 특성(LatitudeBin1, LatitudeBin2, ..., LatitudeBin11)이 생기게 된다. 예를 들어, 위도 37.4라면 6번째 Bin에 들어가게 된다.

이를 이용하여 어떤 빈(Bin)에 들어가는지에 따라, 주택의 가격을 예측하는데 도움을 줄 수 있을 것이다.

### 스크러빙

실무에서는 다음과 같은 이유로 데이터 세트의 여러 데이터들을 신뢰할 수 없다.

****

![8-12](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/png/8-12.PNG)

****

**잘못된 데이터를 발견하면 일반적으로 데이터 셋에서 삭제하여 해당 데이터를 수정한다.**

값 누락이나 중복 데이터를 탐지하고자 간단한 프로그램을 작성할 수 있다.

잘못된 특성 값 또는 라벨을 탐지하기는 훨씬 더 까다롭다.

이는 히스토그램을 통해 집계 데이터를 시각화해보거나 최대 및 최소, 평균 및 중앙값, 표준편차 등의 통계를 이용하여 탐지할수도 있다.

## 철저한 데이터 파악

다음과 같은 규칙을 통해 항상 데이터를 철처하게 파악하도록 하자.

****

첫째, 정상적인 데이터가 어떠한 모습이어야 하는지 항상 생각하자.

둘째, 데이터가 이러한 예상과 일치하는지 확인하고 그렇지 않다면 그 이유를 파악해보자.

셋째, 학습 데이터가 대시보드 등의 다른 소스와 일치하는지 재차 확인하자.

****

핵심적인 코드를 다룰 때와 마찬가지로 데이터에 온 정성을 쏟아야 좋은 머신러닝 모델을 만들어 낼 수 있다는 것을 항상 잊지 말자!

## 실습

[feature_sets.ipynb](https://github.com/Se-Hun/DeepLearningStudy/blob/master/conceptStudy/code/feature_sets.ipynb)
